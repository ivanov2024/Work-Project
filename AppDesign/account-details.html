<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Нова сметка</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
    <div class="mobile-frame">
        <header class="account-details-header">
            <a href="open-account.html" class="back-btn"><i class="fa-solid fa-arrow-left"></i></a>
            <span class="account-details-title section-title">Нова сметка</span>
        </header>
        <main class="account-details-main">
            <div class="account-user-info">
                <span class="account-user-label">Имена</span>
                <span class="account-user-value">Иван</span>
            </div>
            <h2 class="account-details-section-title">Детайли по сметка</h2>
            <div class="account-details-row account-type-row">
    <span class="account-details-label">Вид сметка:</span>
    <span class="account-details-type"><img src="account-icon.png" alt="Account" class="account-type-img"> РАЗПЛАЩАТЕЛНА СМЕТКА</span>
</div>
<div class="account-details-row account-currency-row">
    <label class="account-details-label" for="currency-select">Валутa на сметката</label>
    <!-- Custom currency select trigger -->
    <div id="currency-select-trigger" class="account-details-select custom-select-trigger">Избери валута</div>
    <input type="hidden" id="currency-select-value" name="currency" value="">
    <!-- Native select hidden for accessibility fallback -->
    <select id="currency-select" class="account-details-select" style="display:none;">
        <option value="">Избери валута</option>
        <option value="BGN">BGN</option>
        <option value="EUR">EUR</option>
        <option value="GBP">GBP</option>
    </select>
</div>

<!-- Bank Selection -->
<div class="account-details-row account-bank-row">
    <label class="account-details-label" for="bank-select">Банка</label>
    <div id="bank-select-trigger" class="account-details-select custom-select-trigger">Изберете банка</div>
    <input type="hidden" id="bank-select-value" name="bank" value="">
    <select id="bank-select" class="account-details-select" style="display:none;">
        <option value="">Изберете банка</option>
        <option value="eagle">Орлов Банк</option>
        <option value="vitosha">Витоша Банк</option>
        <option value="danube">Дунав Финанс</option>
        <option value="balkan">Балкан Кредит</option>
        <option value="east">Източна Финансова Група</option>
        <option value="capital">Капитал Траст</option>
        <option value="euro">Евро Стар Банк</option>
    </select>
</div>

<!-- Card Linking Section -->
<div class="account-details-row account-card-row">
    <label class="account-details-label" for="card-link-option">Връзка с карта</label>
    <div class="account-details-select-wrapper">
        <div id="card-link-option-trigger" class="account-details-select custom-select-trigger">Без карта</div>
        <input type="hidden" id="card-link-option-value" name="card_link_option" value="none">
        <select id="card-link-option" class="account-details-select" style="display:none;">
            <option value="none">Без карта</option>
            <option value="existing">Свържи съществуваща карта</option>
            <option value="new">Нова карта</option>
        </select>
    </div>
</div>

<!-- Card Selection (shown when 'existing' is selected) -->
<div id="existing-card-row" class="account-details-row" style="display: none; margin-top: -15px;">
    <label class="account-details-label">Изберете карта</label>
    <div class="account-details-select-wrapper">
        <div id="card-select-trigger" class="account-details-select custom-select-trigger">Изберете карта</div>
        <input type="hidden" id="card-select-value" name="linked_card" value="">
        <select id="card-select" class="account-details-select" style="display:none;">
            <option value="">Изберете карта</option>
            <option value="card1">**** 1234 (Visa)</option>
            <option value="card2">**** 5678 (Mastercard)</option>
        </select>
    </div>
</div>
<!-- Currency Bottom Sheet Popup -->
<div id="currency-sheet" class="currency-sheet" style="display:none;">
    <div class="currency-sheet-backdrop"></div>
    <div class="currency-sheet-modal">
        <div class="currency-sheet-bar"></div>
        <div class="currency-sheet-options">
            <div class="currency-sheet-option" data-value="BGN">BGN</div>
            <div class="currency-sheet-option" data-value="EUR">EUR</div>
            <div class="currency-sheet-option" data-value="GBP">GBP</div>
        </div>
    </div>
</div>

            <form class="account-details-form">
                <div class="account-checkbox-row">
                    <input type="checkbox" id="confirm-all">
                    <label for="confirm-all">Потвърди всичко</label>
                </div>
                <div class="account-checkbox-row">
                    <input type="checkbox" id="terms1">
                    <label for="terms1">Запознат съм с и приемам <a href="#" target="_blank">Общи условия на FinBridge за платежни услуги за физически лица</a>.</label>
<div class="term-desc" style="display:none;">Този документ съдържа всички основни правила, права и задължения, свързани с използването на платежните услуги на FinBridge.</div>
                </div>
                <div class="account-checkbox-row">
                    <input type="checkbox" id="terms2">
                    <label for="terms2">Запознат съм с <a href="#" target="_blank">Такси и комисиони</a>.</label>
<div class="term-desc" style="display:none;">Тук са описани всички приложими такси и комисиони за откриване, поддържане и използване на сметката.</div>
                </div>
                <div class="account-checkbox-row">
                    <input type="checkbox" id="terms3">
                    <label for="terms3">Запознат съм с <a href="#" target="_blank">Тарифи за лихвени условия за физически лица</a>.</label>
<div class="term-desc" style="display:none;">Този документ съдържа информация за лихвените проценти, които се прилагат към средствата по сметката.</div>
                </div>
                <div class="account-checkbox-row">
                    <input type="checkbox" id="terms4">
                    <label for="terms4">Запознат съм и приемам <a href="#" target="_blank">Договор за стандартна разплащателна сметка</a>.</label>
<div class="term-desc" style="display:none;">Официалният договор, който урежда отношенията между клиента и FinBridge за тази сметка.</div>
                </div>
                <div class="account-checkbox-row">
                    <input type="checkbox" id="terms5">
                    <label for="terms5">Запознат съм с <a href="#" target="_blank">Информационен бюлетин за вложителите</a>.</label>
<div class="term-desc" style="display:none;">Бюлетинът предоставя важна информация за защита на вложителите и гаранционни механизми.</div>
                </div>
                <div class="account-checkbox-row">
                    <input type="checkbox" id="terms6">
                    <label for="terms6">Запознат съм с <a href="#" target="_blank">Документ за информация за таксите</a>.</label>
<div class="term-desc" style="display:none;">Документът съдържа подробна информация за всички такси, които могат да бъдат начислени по сметката.</div>
                </div>
                <div class="account-checkbox-row">
                    <input type="checkbox" id="terms7">
                    <label for="terms7">Декларирам, че обичайното ми местопребиваване е в България и/или заявявам продукта/услугата по моя собствена инициатива.</label>
<div class="term-desc" style="display:none;">Това е необходима декларация за съответствие с регулаторните изисквания и за правилното предоставяне на услугата.</div>
                </div>
                <button type="submit" class="account-details-submit" disabled>Продължи</button>
            </form>
        <script>
// --- Custom Bottom Sheet Logic ---
(function() {
    // --- Bank Selection Logic ---
    const bankTrigger = document.getElementById('bank-select-trigger');
    const bankSheet = document.createElement('div');
    bankSheet.id = 'bank-sheet';
    bankSheet.className = 'currency-sheet';
    bankSheet.style.display = 'none';
    bankSheet.innerHTML = `
        <div class="currency-sheet-backdrop"></div>
        <div class="currency-sheet-modal">
            <div class="currency-sheet-bar"></div>
            <div class="currency-sheet-options">
                <div class="currency-sheet-option" data-value="eagle">Орлов Банк</div>
                <div class="currency-sheet-option" data-value="vitosha">Витоша Банк</div>
                <div class="currency-sheet-option" data-value="danube">Дунав Финанс</div>
                <div class="currency-sheet-option" data-value="balkan">Балкан Кредит</div>
                <div class="currency-sheet-option" data-value="east">Източна Финансова Група</div>
                <div class="currency-sheet-option" data-value="capital">Капитал Траст</div>
                <div class="currency-sheet-option" data-value="euro">Евро Стар Банк</div>
            </div>
        </div>`;
    document.body.appendChild(bankSheet);
    const bankBackdrop = bankSheet.querySelector('.currency-sheet-backdrop');
    
    // --- Card Selection Logic ---
    const cardTrigger = document.getElementById('card-select-trigger');
    const cardSheet = document.createElement('div');
    cardSheet.id = 'card-sheet';
    cardSheet.className = 'currency-sheet';
    cardSheet.style.display = 'none';
    cardSheet.innerHTML = `
        <div class="currency-sheet-backdrop"></div>
        <div class="currency-sheet-modal">
            <div class="currency-sheet-bar"></div>
            <div class="currency-sheet-options">
                <div class="currency-sheet-option" data-value="card1">**** 1234 (Visa)</div>
                <div class="currency-sheet-option" data-value="card2">**** 5678 (Mastercard)</div>
            </div>
        </div>`;
    document.body.appendChild(cardSheet);
    const cardBackdrop = cardSheet.querySelector('.currency-sheet-backdrop');
    const cardOptions = cardSheet.querySelectorAll('.currency-sheet-option');
    
    // Card link option elements
    const cardLinkOptionTrigger = document.getElementById('card-link-option-trigger');
    const cardLinkOptionSelect = document.getElementById('card-link-option');
    const cardLinkOptionValue = document.getElementById('card-link-option-value');
    const existingCardRow = document.getElementById('existing-card-row');
    const cardHiddenInput = document.getElementById('card-select-value');
    
    // Card link option sheet
    const cardLinkOptionSheet = document.createElement('div');
    cardLinkOptionSheet.id = 'card-link-option-sheet';
    cardLinkOptionSheet.className = 'currency-sheet';
    cardLinkOptionSheet.style.display = 'none';
    cardLinkOptionSheet.innerHTML = `
        <div class="currency-sheet-backdrop"></div>
        <div class="currency-sheet-modal">
            <div class="currency-sheet-bar"></div>
            <div class="currency-sheet-options">
                <div class="currency-sheet-option" data-value="none">Без карта</div>
                <div class="currency-sheet-option" data-value="existing">Свържи съществуваща карта</div>
            </div>
        </div>`;
    document.body.appendChild(cardLinkOptionSheet);
    const cardLinkOptionBackdrop = cardLinkOptionSheet.querySelector('.currency-sheet-backdrop');
    const cardLinkOptionOptions = cardLinkOptionSheet.querySelectorAll('.currency-sheet-option');
    
    // Initialize bank selection
    const bankOptions = bankSheet.querySelectorAll('.currency-sheet-option');
    const bankHiddenInput = document.getElementById('bank-select-value');
    const bankSelect = document.getElementById('bank-select');
    
    // Bank selection handlers
    function openBankSheet(e) {
        if (e) e.stopPropagation();
        bankSheet.style.display = 'flex';
        setTimeout(() => bankSheet.querySelector('.currency-sheet-modal').focus(), 10);
    }
    
    function closeBankSheet() {
        bankSheet.style.display = 'none';
    }
    
    if (bankTrigger) {
        bankTrigger.addEventListener('click', openBankSheet);
    }
    
    if (bankBackdrop) {
        bankBackdrop.addEventListener('click', closeBankSheet);
    }
    
    bankOptions.forEach(option => {
        option.addEventListener('click', function(e) {
            e.stopPropagation();
            bankOptions.forEach(opt => opt.classList.remove('selected'));
            this.classList.add('selected');
            const value = this.dataset.value;
            const text = this.textContent;
            bankHiddenInput.value = value;
            bankTrigger.textContent = text;
            bankTrigger.classList.add('selected');
            bankSelect.value = value;
            closeBankSheet();
        });
    });
    
    // Card selection handlers
    function openCardSheet() {
        cardSheet.style.display = 'flex';
        setTimeout(() => cardSheet.querySelector('.currency-sheet-modal').focus(), 10);
    }
    
    function closeCardSheet() {
        cardSheet.style.display = 'none';
    }
    
    // Card link option handlers
    function openCardLinkOptionSheet() {
        cardLinkOptionSheet.style.display = 'flex';
        setTimeout(() => cardLinkOptionSheet.querySelector('.currency-sheet-modal').focus(), 10);
    }
    
    function closeCardLinkOptionSheet() {
        cardLinkOptionSheet.style.display = 'none';
    }
    
    // Event listeners for card selection
    if (cardTrigger) {
        cardTrigger.addEventListener('click', function(e) {
            e.stopPropagation();
            openCardSheet();
        });
    }
    
    if (cardBackdrop) {
        cardBackdrop.addEventListener('click', closeCardSheet);
    }
    
    cardOptions.forEach(option => {
        option.addEventListener('click', function(e) {
            e.stopPropagation();
            cardOptions.forEach(opt => opt.classList.remove('selected'));
            this.classList.add('selected');
            const value = this.dataset.value;
            const text = this.textContent;
            cardHiddenInput.value = value;
            cardTrigger.textContent = text;
            cardTrigger.classList.add('selected');
            closeCardSheet();
        });
    });
    
    // Event listeners for card link option
    if (cardLinkOptionTrigger) {
        cardLinkOptionTrigger.addEventListener('click', function(e) {
            e.stopPropagation();
            openCardLinkOptionSheet();
        });
    }
    
    if (cardLinkOptionBackdrop) {
        cardLinkOptionBackdrop.addEventListener('click', closeCardLinkOptionSheet);
    }
    
    cardLinkOptionOptions.forEach(option => {
        option.addEventListener('click', function(e) {
            e.stopPropagation();
            const value = this.dataset.value;
            const text = this.textContent;
            
            // Update the selected option
            cardLinkOptionOptions.forEach(opt => opt.classList.remove('selected'));
            this.classList.add('selected');
            
            // Update the trigger and hidden input
            cardLinkOptionTrigger.textContent = text;
            cardLinkOptionValue.value = value;
            
            // Show/hide card selection based on choice
            if (value === 'existing') {
                existingCardRow.style.display = 'flex';
            } else {
                existingCardRow.style.display = 'none';
                cardHiddenInput.value = '';
                cardTrigger.textContent = 'Изберете карта';
                cardTrigger.classList.remove('selected');
            }
            
            closeCardLinkOptionSheet();
        });
    });
    
    // Initialize with 'none' selected for card link options
    const initialOption = Array.from(cardLinkOptionOptions).find(opt => opt.dataset.value === 'none');
    if (initialOption) {
        initialOption.classList.add('selected');
    }

// --- Custom Currency Bottom Sheet Logic ---
const currencyTrigger = document.getElementById('currency-select-trigger');
const currencySheet = document.getElementById('currency-sheet');
const currencyBackdrop = currencySheet ? currencySheet.querySelector('.currency-sheet-backdrop') : null;
const currencyOptions = currencySheet ? currencySheet.querySelectorAll('.currency-sheet-option') : [];
const currencyHiddenInput = document.getElementById('currency-select-value');
const currencySelect = document.getElementById('currency-select');
const submitBtn = document.querySelector('.account-details-submit');

function openCurrencySheet(e) {
    if (e) e.stopPropagation();
    if (currencySheet) {
        currencySheet.style.display = 'flex';
        const modal = currencySheet.querySelector('.currency-sheet-modal');
        if (modal) setTimeout(() => modal.focus(), 10);
    }
}

function closeCurrencySheet() {
    if (currencySheet) {
        currencySheet.style.display = 'none';
    }
}

function updateSubmitState() {
    const allowed = ['BGN','EUR','GBP'];
    const selected = currencyHiddenInput ? currencyHiddenInput.value : '';
    const allChecked = Array.from(document.querySelectorAll('.account-details-form input[type="checkbox"]'))
        .every(cb => cb.checked);
    
    if (submitBtn) {
        submitBtn.disabled = !(allowed.includes(selected) && allChecked);
    }
}
    // Also update submit state when any checkbox is changed
    const checkboxes = document.querySelectorAll('.account-details-form input[type="checkbox"]');
    checkboxes.forEach(cb => {
        cb.addEventListener('change', updateSubmitState);
    });

    if (currencyTrigger) {
        currencyTrigger.addEventListener('click', openCurrencySheet);
    }
    
    if (currencyBackdrop) {
        currencyBackdrop.addEventListener('click', closeCurrencySheet);
    }
    
    currencyOptions.forEach(opt => {
        opt.addEventListener('click', function(e) {
            e.stopPropagation();
            // Remove highlight from all
            currencyOptions.forEach(o => o.classList.remove('selected'));
            this.classList.add('selected');
            // Set value
            if (currencyHiddenInput) {
                currencyHiddenInput.value = this.dataset.value;
            }
            if (currencyTrigger) {
                currencyTrigger.textContent = this.textContent;
                currencyTrigger.classList.add('selected');
            }
            // Sync native select
            if (currencySelect) {
                currencySelect.value = this.dataset.value;
            }
            updateSubmitState();
            closeCurrencySheet();
        });
    });
    
    // If user changes native select (accessibility fallback)
    if (currencySelect) {
        currencySelect.addEventListener('change', function() {
            if (currencyHiddenInput) {
                currencyHiddenInput.value = this.value;
            }
            if (currencyTrigger) {
                currencyTrigger.textContent = this.value || 'Избери валута';
                currencyTrigger.classList.toggle('selected', !!this.value);
            }
            currencyOptions.forEach(o => o.classList.toggle('selected', o.dataset.value === this.value));
            updateSubmitState();
        });
    }
    // Initial state
    updateSubmitState();
})();
</script>
</main>
    </div>

    <!-- Popup Modal for Terms -->
    <div id="terms-modal" class="terms-modal" style="display:none;">
        <div class="terms-modal-content">
            <button class="terms-modal-close back-btn" id="terms-modal-close" aria-label="Затвори"><i class="fa-solid fa-xmark"></i></button>
            <div id="terms-modal-title" class="terms-modal-title"></div>
            <div id="terms-modal-body" class="terms-modal-body"></div>
        </div>
        <div class="terms-modal-backdrop"></div>
    </div>

    <script>
    // Enable the submit button only if all checkboxes are checked
    const form = document.querySelector('.account-details-form');
    const checkboxes = form.querySelectorAll('input[type="checkbox"]');
    const submitBtn = form.querySelector('.account-details-submit');
    const confirmAll = document.getElementById('confirm-all');
    function updateSubmitState() {
        let allChecked = true;
        checkboxes.forEach(cb => { if (!cb.checked && cb.id !== 'confirm-all') allChecked = false; });
        submitBtn.disabled = !allChecked;
    }
    checkboxes.forEach(cb => {
        cb.addEventListener('change', updateSubmitState);
    });
    confirmAll.addEventListener('change', function() {
        checkboxes.forEach(cb => { if (cb.id !== 'confirm-all') cb.checked = confirmAll.checked; });
        updateSubmitState();
    });
    form.addEventListener('change', updateSubmitState);
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        alert('Формата е изпратена!');
    });

    // Terms modal logic
    const termsContent = {
        'terms1': {
            title: 'Общи условия на FinBridge за платежни услуги за физически лица',
            body: 'Този документ съдържа всички основни правила, права и задължения, свързани с използването на платежните услуги на FinBridge. Той урежда взаимоотношенията между клиента и доставчика на услуги, включително процедури по откриване и закриване на сметка, права за достъп, защита на лични данни и др.'
        },
        'terms2': {
            title: 'Такси и комисиони',
            body: 'Тук са описани всички приложими такси и комисиони за откриване, поддържане и използване на сметката. Включва информация за месечни такси, такси за преводи, тегления и други услуги.'
        },
        'terms3': {
            title: 'Тарифи за лихвени условия за физически лица',
            body: 'Този документ съдържа информация за лихвените проценти, които се прилагат към средствата по сметката. Описва как се начислява лихва, периоди на изплащане и условия за промяна на лихвения процент.'
        },
        'terms4': {
            title: 'Договор за стандартна разплащателна сметка',
            body: 'Официалният договор, който урежда отношенията между клиента и FinBridge за тази сметка. Включва права и задължения, условия за прекратяване и други важни клаузи.'
        },
        'terms5': {
            title: 'Информационен бюлетин за вложителите',
            body: 'Бюлетинът предоставя важна информация за защита на вложителите и гаранционни механизми. Описва как се защитават средствата на клиента в случай на неплатежоспособност на банката.'
        },
        'terms6': {
            title: 'Документ за информация за таксите',
            body: 'Документът съдържа подробна информация за всички такси, които могат да бъдат начислени по сметката, както и примери за изчисление.'
        }
    };
    document.querySelectorAll('.account-checkbox-row a').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            // Find the closest checkbox row and get its input id
            const row = e.target.closest('.account-checkbox-row');
            const input = row ? row.querySelector('input[type="checkbox"]') : null;
            if (input && termsContent[input.id]) {
                document.getElementById('terms-modal-title').textContent = termsContent[input.id].title;
                document.getElementById('terms-modal-body').textContent = termsContent[input.id].body;
                document.getElementById('terms-modal').style.display = 'flex';
            }
        });
    });
    document.getElementById('terms-modal-close').onclick = function() {
        document.getElementById('terms-modal').style.display = 'none';
    };
    document.querySelector('.terms-modal-backdrop').onclick = function() {
        document.getElementById('terms-modal').style.display = 'none';
    };
    </script>
</body>
</html>
