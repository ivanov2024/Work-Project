@page "/register"

@using Microsoft.AspNetCore.Components.Forms
@using FinBridge.App.Models
@using FinBridge.App.Services

@inject NavigationManager Navigation
@inject IAuthenticationService authService

<div class="app-background">
    <h3>Създаване на профил</h3>

    <EditForm Model="@registerModel" OnValidSubmit="HandleRegister">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <div class="form-group">
            <label>Въведе първото Ви име:</label>
            <InputText @bind-Value="registerModel.FirstName" class="input-field" placeholder="Например: Иван" />
        </div>

        <div class="form-group">
            <label>Въведе вашето презиме:</label>
            <InputText @bind-Value="registerModel.MiddleName" class="input-field" placeholder="Например: Горанов" />
        </div>

        <div class="form-group">
            <label>Въведете вашата фамилия:</label>
            <InputText @bind-Value="registerModel.LastName" class="input-field" placeholder="например: Цветанков" />
        </div>

        <div class="form-group">
            <label>Въведете вашият имейл:</label>
            <InputText @bind-Value="registerModel.Email" class="input-field" placeholder="example@example.com" />
        </div>

        <div class="form-group">
            <label>Въведе измислена от вас парола:</label>
            <InputText @bind-Value="registerModel.Password" type="password" class="input-field" />
        </div>

        <div class="form-group">
            <label>Потвърдете измислената от вас парола:</label>
            <InputText @bind-Value="registerModel.ConfirmPassword" type="password" class="input-field" />
        </div>

        <div class="checkbox-wrapper">
            <InputCheckbox @bind-Value="registerModel.RememberMe" />
            <label>Запомни ме</label>
        </div>

        <button type="submit" disabled="@isSubmitting">Регистрирайте се</button>
    </EditForm>

    <p>
        Вече имате акаунт?
        <a @onclick="NavigateToLogin">Влезте в профила си</a>
    </p>
</div>

@code {
    private RegisterRequest registerModel = new();
    private bool isSubmitting;

    private void NavigateToLogin()
    {
        Navigation.NavigateTo("/login");
    }

    private async Task HandleRegister()
    {
        if (isSubmitting) return;

        try
        {
            isSubmitting = true;
            var result = await authService.RegisterAsync(registerModel);
            
            if (result)
            {
                Navigation.NavigateTo("/home");
            }
            else
            {
                // TODO: Add proper error handling/display
                Console.WriteLine("Authentication failed.");
            }
        }
        finally
        {
            isSubmitting = false;
        }
    }
}
