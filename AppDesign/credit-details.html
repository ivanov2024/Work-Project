<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Детайли за кредит | Банка</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body class="credit-details-page">
    <div class="mobile-frame">
        <header class="open-account-header">
            <a href="credits.html" class="back-btn"><i class="fa-solid fa-arrow-left"></i></a>
            <span class="account-details-title section-title">Детайли за кредит</span>
        </header>
        
        <main class="credit-details-main">
            <div class="credit-summary">
                <div class="credit-details-icon">
                    <i class="fas fa-home"></i>
                </div>
                <h2 class="credit-name"></h2>
                <div class="credit-amount"></div>
                <div class="credit-status active"></div>
            </div>
            
            <div class="credit-info-section">
                <div class="info-card credit-info-card">
                    <h3>Основна информация</h3>
                    <div class="credit-info-wrapper">
                        <div class="info-detail">
                            <span class="info-label">Номер на кредит:</span>
                            <span class="info-value credit-number"></span>
                        </div>
                        <div class="info-detail">
                            <span class="info-label">Дата на отпускане:</span>
                            <span class="info-value credit-date"></span>
                        </div>
                        <div class="info-detail">
                            <span class="info-label">Срок (месеци):</span>
                            <span class="info-value credit-term"></span>
                        </div>
                        <div class="info-detail">
                            <span class="info-label">Лихва:</span>  
                            <span class="info-value credit-rate"></span>
                        </div>
                    </div>
                </div>
                
                <div class="info-card credit-status-card">
                    <h3>Състояние на кредита</h3>
                    <div class="credit-progress-wrapper">
                        <div class="progress-summary">
                            <span class="progress-percentage">0%</span>
                            <span class="progress-amount">0 лв / 0 лв</span>
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar"></div>
                        </div>
                        <div class="progress-details">
                            <div class="progress-detail">
                                <span class="detail-label">Оставащ главник:</span>
                                <span class="detail-value remaining-amount">0.00 лв</span>
                            </div>
                            <div class="progress-detail">
                                <span class="detail-label">Следваща вноска:</span>
                                <span class="detail-value next-payment">0.00 лв</span>
                            </div>
                            <div class="progress-detail">
                                <span class="detail-label">Дата на следваща вноска:</span>
                                <span class="detail-value next-payment-date">--.--.----</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="info-card payments-card">
                    <h3>Следващи плащания</h3>
                    <div class="payments-container">
                        <!-- Header -->
                        <div class="payments-header">
                            <div class="payment-content">
                                <div class="col-date">Дата</div>
                                <div class="col-amount">Сума</div>
                                <div class="col-status">Статус</div>
                            </div>
                        </div>
                        
                        <!-- Payments List -->
                        <div class="payments-list">
                            <!-- Payments will be inserted here by JavaScript -->
                        </div>
                        
                        <!-- Footer -->
                        <button class="view-all-payments">Виж всички плащания</button>
                    </div>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn-primary">Направи извънредно плащане</button>
                <button class="btn-secondary">Изтепи извлечение</button>
            </div>
        </main>
    </div>
    
    <!-- Payments Modal -->
    <div id="payments-modal" class="terms-modal" style="display:none;">
        <div class="terms-modal-content">
            <div class="terms-modal-content-inner">
                <button class="terms-modal-close" id="payments-modal-close" aria-label="Затвори">
                    <i class="fa-solid fa-xmark"></i>
                </button>
                <div class="terms-modal-title">Всички плащания</div>
                <div class="payments-modal-container">
                    <div id="all-payments-list" class="payments-list-vertical">
                        <!-- Payments will be inserted here by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
        <div class="terms-modal-backdrop"></div>
    </div>
    
    <script>
        // Credit data - in a real app, this would come from an API
        const creditsData = {
            '1': {
                id: '1',
                type: 'Ипотечен Кредит',
                amount: 120000,
                status: 'Активен',
                number: 'CRD-2023-12345',
                startDate: '15.03.2023',
                term: 360,
                interestRate: 3.5,
                paidAmount: 36000,
                remainingAmount: 84000,
                nextPayment: {
                    amount: 850,
                    dueDate: '15.06.2023'
                },
                icon: 'fa-home',
                payments: [
                    { date: '15.06.2023', amount: 850, status: 'Планирано' },
                    { date: '15.07.2023', amount: 850, status: 'Планирано' },
                    { date: '15.08.2023', amount: 850, status: 'Планирано' }
                ]
            },
            '2': {
                id: '2',
                type: 'Автокредит',
                amount: 35000,
                status: 'Активен',
                number: 'CRD-2023-12346',
                startDate: '10.01.2023',
                term: 60,
                interestRate: 4.9,
                paidAmount: 14000,
                remainingAmount: 21000,
                nextPayment: {
                    amount: 520,
                    dueDate: '10.07.2023'
                },
                icon: 'fa-car',
                payments: [
                    { date: '10.06.2023', amount: 520, status: 'Платено' },
                    { date: '10.07.2023', amount: 520, status: 'Планирано' },
                    { date: '10.08.2023', amount: 520, status: 'Планирано' }
                ]
            },
            '3': {
                id: '3',
                type: 'Персонален Кредит',
                amount: 10000,
                status: 'Активен',
                number: 'CRD-2023-12347',
                startDate: '05.05.2023',
                term: 36,
                interestRate: 7.9,
                paidAmount: 2000,
                remainingAmount: 8000,
                nextPayment: {
                    amount: 310,
                    dueDate: '05.07.2023'
                },
                icon: 'fa-wallet',
                payments: [
                    { date: '05.06.2023', amount: 310, status: 'Платено' },
                    { date: '05.07.2023', amount: 310, status: 'Планирано' },
                    { date: '05.08.2023', amount: 310, status: 'Планирано' }
                ]
            }
        };

        // Set the mobile frame height
        function setMobileFrameHeight() {
            const frame = document.querySelector('.mobile-frame');
            frame.style.height = window.innerHeight + 'px';
        }

        // Format currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('bg-BG', { 
                style: 'decimal', 
                minimumFractionDigits: 2,
                maximumFractionDigits: 2 
            }).format(amount) + ' лв';
        }

        // Calculate progress percentage
        function calculateProgress(paid, total) {
            return Math.round((paid / total) * 100);
        }

        // Update page with credit data
        function updateCreditDetails(credit) {
            // Update basic credit info
            document.querySelector('.credit-name').textContent = credit.type;
            document.querySelector('.credit-amount').textContent = formatCurrency(credit.amount);
            document.querySelector('.credit-status').textContent = credit.status;
            document.querySelector('.credit-number').textContent = credit.number;
            document.querySelector('.credit-date').textContent = credit.startDate;
            document.querySelector('.credit-term').textContent = credit.term;
            document.querySelector('.credit-rate').textContent = `${credit.interestRate}% годишно`;
            document.querySelector('.next-payment').textContent = formatCurrency(credit.nextPayment.amount);
            document.querySelector('.next-payment-date').textContent = credit.nextPayment.dueDate;
            document.querySelector('.remaining-amount').textContent = formatCurrency(credit.remainingAmount);
            
            // Update progress bar
            const progressBar = document.querySelector('.progress-bar');
            if (progressBar) {
                const progress = calculateProgress(credit.paidAmount, credit.amount);
                progressBar.style.width = `${progress}%`;
            }
            
            // Update payments list in main view
            const paymentsList = document.querySelector('.payments-list');
            if (paymentsList) {
                // Clear existing placeholders
                paymentsList.innerHTML = '';
                
                // Add real payments (limited to 3 in main view)
                credit.payments.slice(0, 3).forEach(payment => {
                    const paymentRow = document.createElement('div');
                    paymentRow.className = 'payments-row';
                    paymentRow.innerHTML = `
                        <div class="payment-content">
                            <div class="col-date">${payment.date}</div>
                            <div class="col-amount">${formatCurrency(payment.amount)}</div>
                            <div class="col-status ${payment.status === 'Платено' ? 'status-completed' : 'status-upcoming'}">
                                ${payment.status}
                            </div>
                        </div>
                    `;
                    paymentsList.appendChild(paymentRow);
                });
                
                // Update all payments in modal
                const allPaymentsList = document.getElementById('all-payments-list');
                if (allPaymentsList) {
                    allPaymentsList.innerHTML = '';
                    credit.payments.forEach(payment => {
                        const paymentRow = document.createElement('div');
                        paymentRow.className = 'payment-item';
                        paymentRow.innerHTML = `
                            <div class="payment-content">
                                <div class="payment-row">
                                    <span class="payment-label">Дата:</span>
                                    <span class="payment-value">${payment.date}</span>
                                </div>
                                <div class="payment-row">
                                    <span class="payment-label">Сума:</span>
                                    <span class="payment-value">${formatCurrency(payment.amount)}</span>
                                </div>
                                <div class="payment-row">
                                    <span class="payment-label">Статус:</span>
                                    <span class="payment-value ${payment.status === 'Платено' ? 'status-completed' : 'status-upcoming'}">
                                        ${payment.status}
                                    </span>
                                </div>
                            </div>
                        `;
                        allPaymentsList.appendChild(paymentRow);
                    });
                }
            }
        }

        // Payments Modal Elements
        const paymentsModal = document.getElementById('payments-modal');
        const paymentsModalClose = document.getElementById('payments-modal-close');
        const viewAllPaymentsBtn = document.querySelector('.view-all-payments');
        const allPaymentsList = document.getElementById('all-payments-list');
        
        // Open payments modal
        function openPaymentsModal() {
            if (paymentsModal) {
                paymentsModal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
                // Scroll to top when opening
                const contentInner = paymentsModal.querySelector('.terms-modal-content-inner');
                if (contentInner) {
                    contentInner.scrollTop = 0;
                }
            }
        }
        
        // Close payments modal
        function closePaymentsModal() {
            if (paymentsModal) {
                paymentsModal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        }
        
        // Event listeners for modal
        if (viewAllPaymentsBtn) {
            viewAllPaymentsBtn.addEventListener('click', openPaymentsModal);
        }
        if (paymentsModalClose) {
            paymentsModalClose.addEventListener('click', closePaymentsModal);
        }
        if (paymentsModal) {
            paymentsModal.querySelector('.terms-modal-backdrop').addEventListener('click', closePaymentsModal);
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            setMobileFrameHeight();
            
            // Get credit ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            const creditId = urlParams.get('id');
            
            if (creditId && creditsData[creditId]) {
                updateCreditDetails(creditsData[creditId]);
            } else {
                // Handle invalid or missing credit ID
                console.error('Invalid or missing credit ID');
                // Redirect back to credits page or show error
                // window.location.href = 'credits.html';
            }
        });

        window.addEventListener('resize', setMobileFrameHeight);
    </script>
</body>
</html>
